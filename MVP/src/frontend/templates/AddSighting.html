<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Seal Center</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='css/AddSightingStyle.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
  </head>
  <body>
    <input
      type="text"
      id="imageNameInput"
      class="input-bar"
      placeholder="Insert Name"
    />

    <div class="drop-zone" id="dropZone">
      <div class="drop-message" id="dropMessage">Drag & Drop</div>
      <label for="fileInput" class="ButtonInput">
        <i class="fas fa-upload"></i>
        <input
          type="file"
          id="fileInput"
          accept="image/*"
          style="display: none"
        />
      </label>
      <div id="imagePreview"></div>
    </div>

    <div id="imageContainer"></div>

    <button class="detect-seal-btn" onclick="detectSeal()">Detect Seal</button>

    <script>
      function detectSeal() {
        const imageName = document.getElementById("imageNameInput").value;
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];

        if (file) {
          const reader = new FileReader();

          reader.onload = function (e) {
            const img = new Image();
            img.src = e.target.result;
            img.onload = function () {
              const canvas = document.createElement("canvas");
              const ctx = canvas.getContext("2d");
              canvas.width = 300;
              canvas.height = (300 * img.height) / img.width;
              ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
              const resizedDataUrl = canvas.toDataURL("image/jpeg");

              const newWindow = window.open("");
              newWindow.document.write(
                `<img src="${resizedDataUrl}" alt="${imageName}" class="new-image">`
              );
              newWindow.document.title = imageName;
            };
          };

          reader.readAsDataURL(file);
        } else {
          alert("Please select an image first.");
        }
      }
    </script>
  </body>
</html>
